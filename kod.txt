AÅŸaÄŸÄ±da Jupyter Notebook uyumlu olacak ÅŸekilde, **kiÅŸileri benzersiz ÅŸekilde sayan**, **anlÄ±k kiÅŸi sayÄ±mÄ±nÄ± yapan** ve **kalabalÄ±k yoÄŸunluÄŸunu hesaplayan** bir kod yapÄ±sÄ±nÄ± adÄ±m adÄ±m sana veriyorum. Bu yapÄ± senin Ã¶nceki kodunun Ã¼zerine kuruldu, ve `ByteTrack` kullanÄ±yor.

---

### ğŸ“¦ 1. Gerekli Kurulumlar

```python
!pip install ultralytics supervision bytetrack opencv-python
```

---

### ğŸ“ 2. Gerekli KÃ¼tÃ¼phaneler

```python
import cv2
import os
from ultralytics import YOLO
from supervision import Detections, BoxAnnotator, LabelAnnotator, Color
from supervision.tools.detections import Box
from supervision.tracking.byte_tracker import BYTETracker
```

---

### ğŸ“¦ 3. Model ve Tracker BaÅŸlat

```python
model = YOLO("yolov8n.pt")  # YOLO modeli
tracker = BYTETracker()     # ByteTrack nesne izleyici
```

---

### ğŸ“¹ 4. Video ve YazÄ±cÄ± AyarlarÄ±

```python
video_path = "street.mp4"
output_video_path = "output/street_detection.mp4"
cap = cv2.VideoCapture(video_path)

width  = int(cap.get(cv2.CAP_PROP_FRAME_WIDTH))
height = int(cap.get(cv2.CAP_PROP_FRAME_HEIGHT))
fps    = cap.get(cv2.CAP_PROP_FPS)

os.makedirs("output", exist_ok=True)

fourcc = cv2.VideoWriter_fourcc(*'mp4v')
out = cv2.VideoWriter(output_video_path, fourcc, fps, (width, height))
```

---

### ğŸ§  5. Annotator ve SayaÃ§lar

```python
box_annotator = BoxAnnotator(thickness=2, color=Color(255, 0, 0))
label_annotator = LabelAnnotator(text_thickness=2, text_scale=1, text_color=Color(255, 255, 255), color=Color(0, 0, 0))

unique_ids = set()         # Her benzersiz kiÅŸi iÃ§in ID tutar
frame_idx = 0              # Kare sayacÄ±
```

---

### ğŸ§® 6. Kare Ä°ÅŸleme ve Takip

```python
while cap.isOpened():
    ret, frame = cap.read()
    if not ret:
        break

    results = model(frame, classes=0, conf=0.25)[0]
    detections = Detections.from_ultralytics(results)

    # Takip yap
    detections = tracker.update_with_detections(detections)

    # KiÅŸi sayÄ±mÄ± iÃ§in ID'leri topla
    for track_id in detections.tracker_id:
        if track_id not in unique_ids:
            unique_ids.add(track_id)

    current_count = len(detections.tracker_id)      # O anki karedeki kiÅŸi sayÄ±sÄ±
    total_count = len(unique_ids)                   # Videoda tespit edilen toplam kiÅŸi sayÄ±sÄ±

    # KalabalÄ±k yoÄŸunluÄŸu: kiÅŸi sayÄ±sÄ± / toplam alan (piksel cinsinden)
    area = width * height
    density = current_count / area * 1e6  # NormalleÅŸtirme iÃ§in 1M ile Ã§arpÄ±ldÄ±

    # Etiketler
    labels = [f"ID: {track_id}" for track_id in detections.tracker_id]
    frame = box_annotator.annotate(frame, detections)
    frame = label_annotator.annotate(frame, detections, labels)

    # SayaÃ§larÄ± ekrana yaz
    cv2.putText(frame, f"Current Count: {current_count}", (20, 40), cv2.FONT_HERSHEY_SIMPLEX, 1, (0,255,0), 2)
    cv2.putText(frame, f"Total Count: {total_count}", (20, 80), cv2.FONT_HERSHEY_SIMPLEX, 1, (0,255,0), 2)
    cv2.putText(frame, f"Density: {density:.4f}", (20, 120), cv2.FONT_HERSHEY_SIMPLEX, 1, (0,0,255), 2)

    out.write(frame)
    frame_idx += 1
```

---

### ğŸ›‘ 7. Temizlik

```python
cap.release()
out.release()
cv2.destroyAllWindows()

print(f"Toplam kiÅŸi sayÄ±sÄ±: {total_count}")
```

---

### âœ… Bu Kod Ne Yapar?

| Ã–zellik                   | AÃ§Ä±klama                                                 |
| ------------------------- | -------------------------------------------------------- |
| **Benzersiz kiÅŸi takibi** | `ByteTrack` ile ID atayÄ±p aynÄ± kiÅŸiyi tekrar saymaz.     |
| **AnlÄ±k kiÅŸi sayÄ±mÄ±**     | Her karedeki mevcut kiÅŸi sayÄ±sÄ±nÄ± gÃ¶sterir.              |
| **Toplam kiÅŸi sayÄ±mÄ±**    | Videoda toplam kaÃ§ farklÄ± kiÅŸi gÃ¶rÃ¼ndÃ¼ÄŸÃ¼nÃ¼ sayar.        |
| **KalabalÄ±k yoÄŸunluÄŸu**   | Alan baÅŸÄ±na kiÅŸi yoÄŸunluÄŸunu hesaplar (M piksel baÅŸÄ±na). |

---

Ä°stersen belirli bÃ¶lgelere gÃ¶re yoÄŸunluk Ã¶lÃ§Ã¼mÃ¼ (Ã¶rneÄŸin: frame'in ortasÄ±, sol taraf gibi) de ekleyebilirim.

Devam edelim mi?
